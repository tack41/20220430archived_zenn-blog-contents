---
title: "ADç’°å¢ƒã®Windowsã‚’Ansibleã§æ“ä½œã™ã‚‹"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [mac,windows,bootcamp]
published: true
---

## TL;DR

Active Directryã«å‚åŠ ã—ã¦ã„ã‚‹Window10ã‚’WSL2ã®Ubuntu20.04ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸAnsibleã§æ“ä½œã™ã‚‹ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚è¤‡é›‘ãªæ‰‹é †ãŒå¿…è¦ã§ã™ãŒã€æ“ä½œã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

## æ‰‹é †

1. ä»¥ä¸‹ã®aptãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   * python3-pip
   * gcc
   * python-dev
   * libkrb5-dev
   * krb5-user
1. pip3ã§ä»¥ä¸‹ã®Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   * pywinrm\[kerberos\]
   * kerberos
   * requests_kerberos
   * pykerberos
1. ä»¥ä¸‹ã®å†…å®¹ã§`/etc/krb5.conf`ã‚’ä¿®æ­£

   ```text
    [libdefaults]
        default_realm = EXAMPLE.COM
        kdc_timesync = 1
        ccache_type = 4
        forwardable = true
        proxiable = true

    [realms]
        EXAMPLE.COM = {
            kdc = dc1.example.com
        }

    [domain_realm]
        .example.com = EXAMPLE.COM
   ```

1. `/etc/hosts` ã«ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ 

   ```text
   192.168.xxx.xxx dc1.example.com
   ```

1. `inventory.yml`ã«ä»¥ä¸‹ã®è¨˜è¿°ã‚’è¨˜è¼‰

   ```yaml
    windows:
    hosts:
        192.168.yyy.yyy:
        ansible_connection: winrm
        ansible_user: user_name
        ansible_winrm_server_cert_validation: ignore
        ansible_winrm_transport: kerberos
        ansible_port: 5986
        ansible_winrm_kerberos_delegation: yes
   ```

1. `ansible -i inventory.yml 192.168.yyy.yyy -m win_ping` ãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª
