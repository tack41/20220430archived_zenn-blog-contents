---
title: "Active Directoryã§ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«PowershellçµŒç”±ã§exeã‚’å®Ÿè¡Œ"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [active_directory,powershell]
published: true
---

## TL;DR

* Active Directoryã§ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«exeãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯`Start-Process`ã§ã®å®Ÿè¡ŒãŒå¿…è¦

## çµŒç·¯

EmotetãŒæµè¡Œã£ã¦ã„ã‚‹ã®ã§ã€[Emocheck](https://github.com/JPCERTCC/EmoCheck/releases)ã‚’Active Directory ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ä»•è¾¼ã‚“ã§ã¿ã¦ã„ãŸã€‚

å˜ä½“ã§ã¯å®Ÿè¡Œã§ãã‚‹ã®ã§å•é¡Œãªã„ã¨è€ƒãˆã¦ã„ãŸãŒã€ã©ã†ã‚‚Active Directory ã®ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒªã‚·ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«èµ·å‹•ã™ã‚‹è¨­å®šã‚’ã™ã‚‹ã¨ä½•æ•…ã‹å®Ÿè¡Œã•ã‚Œãªã„ã€‚ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã‚’è¦‹ã‚‹ã¨ä¸€å¿œå¯¾è±¡ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã„ã‚‹ã®ã ãŒ...

Powershell ã‹ã‚‰å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã„ãã¤ã‹æ–¹æ³•ãŒã‚ã‚‹ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã¨ãƒ€ãƒ¡ãªã‚ˆã†ã ã£ãŸã€‚

```powershell
$proc = New-Object "System.Diagnostics.Process"
$psi = New-Object "System.Diagnostics.ProcessStartInfo"
$psi.FileName = $emocheck_Exe
$psi.Arguments = "-output $reportDir -quiet -json"
$psi.CreateNoWindow = $true;
$psi.UseShellExecute = $false
$psi.WindowStyle = [System.Diagnostics.ProcessWindowStyle]::Hidden

$proc.StartInfo = $psi
$proc.Start()
```

ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ã§ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

```powershell
Start-Process -WindowStyle Hidden -FilePath $emocheck_Exe -ArgumentList "-output $reportDir -quiet -json" -WorkingDirectory $currentDir
```