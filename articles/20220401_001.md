---
title: "Redmineã®DBã‚’PostgreSQLã‹ã‚‰MariaDBã«ç§»è¡Œ"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [redmine,postgresql,mariadb]
published: true
---

## TL;DR

* Redmine 4.2.5ã«ã¦ã€[yaml_db](https://rubygems.org/gems/yaml_db/)ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§PostgreSQL(14.2)ã‹ã‚‰MariaDB(10.4.24)ã«ç§»è¡Œã§ãã¾ã—ãŸ

## çµŒç·¯

GCPã®VMã®ç„¡æ–™æ (e2-small,Mem:1GB,HDD:30GB)ã§ä»¥ä¸‹ã®Dockerã‚³ãƒ³ãƒ†ãƒŠã‚¯ãƒ©ã‚¹ã‚¿(docker-compose)ã§redmineã‚’é‹ç”¨ã—ã¦ã„ã¾ã™ã€‚

* [redmine](https://hub.docker.com/_/redmine): 4.2.5-alpihne
* [postgres](https://hub.docker.com/_/postgres): 14.2-alpine
* [steveltn/https-portal](https://hub.docker.com/r/steveltn/https-portal): 1.21.1

ç’°å¢ƒãŒæ¿€poorãªã“ã¨ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãŸã¾ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§10ç§’è¿‘ãå¾…ãŸã•ã‚Œã‚‹ã“ã¨ã‚‚ã€‚ãã“ã§ã€ã‚ˆã‚Šè»½é‡ã¨æ€ã‚ã‚Œã‚‹MySQLç³»ã®[MariaDB](https://hub.docker.com/_/mariadb)(10.4.24)ã«ç§»è¡Œã—ã¾ã—ãŸã€‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæ”¹å–„ã•ã‚ŒãŸã‹ã©ã†ã‹ã¯ã€ç¾åœ¨æ§˜å­è¦‹ã§ã™ã€‚

ä»¥ä¸‹ã®æ‰‹é †ã‚’è¸ã¿ã¾ã—ãŸã€‚

1. ã‚³ãƒ³ãƒ†ãƒŠã‚¯ãƒ©ã‚¹ã‚¿ã‚’åœæ­¢
1. `docker-compose.yml`ã«MariaDBã‚³ãƒ³ãƒ†ãƒŠã‚’è¿½åŠ ã—ã€redmineã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰æ¥ç¶šã§ãã‚‹ã‚ˆã†networkè¨­å®šã—ã€rootãŸä¸Šã§èµ·å‹•
1. `docker-compose exec`ã‚³ãƒãƒ³ãƒ‰ã§redmineã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶š
   1. `apk-add mariadb-client`ã‚’å®Ÿè¡Œã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   1. `/usr/src/redmine/config/database.yml`ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—ã—ãŸä¸Šã§ã€è¨˜è¿°ã‚’MariaDBã«æ¥ç¶šã§ãã‚‹ã‚ˆã†(adapterã¯`mysql2`)
   1. mysqlã‚³ãƒãƒ³ãƒ‰ã§MariaDBã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã—ã€[Install Redmine](https://www.redmine.org/projects/redmine/wiki/redmineinstall)ã®æ‰‹é †ã‚’å‚è€ƒã«DBã‚’ä½œæˆ
   1. Install Redmine](https://www.redmine.org/projects/redmine/wiki/redmineinstall)ã®æ‰‹é †ã‚’å‚è€ƒã«`rake db:migrate`ã§DBã‚’åˆæœŸåŒ–
   1. `/usr/src/redmine/Gemfile`ã«`gem "yaml_db"`ã®è¨˜è¿°ã‚’è¿½åŠ ã—ã¦`gem bundle update`ã‚’å®Ÿè¡Œã€‚ã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ãŒã€é€”ä¸­`yaml_db`ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒæˆåŠŸã—ã¦ã„ã‚Œã°OK
   1. `/usr/src/redmine/config/database.yml`ã‚’æ›´ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ãŸä¸Šã§ã€å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã„ãŸPostgreSQLç”¨ã®è¨­å®šã«æˆ»ã—ã¦`RAILS_ENV=production bundle exec rake db:data:dump`ã‚’å®Ÿè¡Œã€‚`/usr/src/redmine/db/data.yml`ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒä½œæˆã•ã‚Œã‚‹
   1. `/usr/src/redmine/config/database.yml`ã‚’MariaDBã®è¨­å®šã«æˆ»ã—ã€`RAILS_ENV=production bundle exec rake db:data:load`ã‚’å®Ÿè¡Œã€‚
   1. mysqlã‚³ãƒãƒ³ãƒ‰ã§MariaDBã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã—ã€ãƒ‡ãƒ¼ã‚¿ãŒãƒªã‚¹ãƒˆã‚¢ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
1. `docker-compose.yml`ã®PostgreSQLã‚³ãƒ³ãƒ†ãƒŠã®è¨˜è¿°ã‚’å‰Šé™¤ã—ã€redmineã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰MariaDBã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã™ã‚‹ã‚ˆã†è¨­å®šã‚’ä¿®æ­£ã—ãŸä¸Šã§èµ·å‹•ã€‚

å‚è€ƒã‚µã‚¤ãƒˆ: https://hnron.hatenablog.com/entry/2015/08/18/012738